<!DOCTYPE html>
<html>
<style>

.mytext{
    border:0;
    width:300px;
    height:50px;
    word-break: break-all;
    background-color:whitesmoke;
    padding:25px;
}
.text{
    width:75%;display:flex;flex-direction:column;
    word-break: break-all;
}
.comment_text{
    width:100%;margin-top:0;margin-bottom:auto;line-height: 13px;font-size: 12px;
}

.comment_username{
    width:100%;text-align:right;color:rgba(0, 30, 34, 0.8);margin-bottom:-4px;margin-top:auto;font-size:75%;
}

.comment_time{
    width:100%;text-align:right;color:silver;margin-bottom:-4px;margin-top:auto;font-size:75%;
}
.text-l{
    float:left;padding-right:10px;
}
.text-r{
    float:right;padding-left:10px;
}
.avatar{
    display:flex;
    justify-content:center;
    align-items:center;
    width:40px;
    height:40px;
    float:left;
    padding-right:10px;
}
.macro{
    margin-top:5px;width:85%;border-radius:5px;padding:1px;display:flex;
}
.msj-rta{
    float:right;background:whitesmoke;
}
.msj{
    float:left;background:white;
}
.frame{
    background:rgba(0, 30, 34, 0.8);
    border-radius: 25px;
    border-color:#2fcbe0;
    height:450px;
    width:300px;
    overflow:hidden;
    position:absolute;
    top:200px;
    right:80px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.8);
}
.frame > div:last-of-type{
    bottom:0px;
    width:100%;
    position: absolute;
}

.msj:before{

    width: 0;
    height: 0;
    content:"";
    top:-5px;
    left:-14px;
    border-style: solid;
    border-width: 0 13px 13px 0;
    border-color: transparent #ffffff transparent transparent;
}
.msj-rta:after{
    width: 0;
    height: 0;
    content:"";
    top:-5px;
    left:14px;
    border-style: solid;
    border-width: 13px 13px 0 0;
    border-color: whitesmoke transparent transparent transparent;
}
input:focus{
    outline: none;
}
::-webkit-input-placeholder { /* Chrome/Opera/Safari */
    color: #d4d4d4;
}
::-moz-placeholder { /* Firefox 19+ */
    color: #d4d4d4;
}
:-ms-input-placeholder { /* IE 10+ */
    color: #d4d4d4;
}
:-moz-placeholder { /* Firefox 18- */
    color: #d4d4d4;
}
.mydiv{
    width:50%;
    height:50%;

}

.chatbutton{
    font-family: 'Open Sans';
    text-align: center;
    display: inline-block;
    font-size:16px;
    margin: 4px 2px;
    transition-duration: 0.4s;
    cursor: pointer;
    position:absolute;
    right:155px;
    width:150px;
    height:50px;
    top:140px;
    background-color: rgba(0, 30, 34, 0.85);
    color:white;
    border: none;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.8);
}

.chatbutton:hover{
    background-color: #2fcbe0;
    opacity:0.90;
    color:white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.8);
}

.chatbutton:active{
    background-color: #2fcbe0;
    opacity:0.90;
    color:white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.8);
}

.comments_box{
    width:290px;
    height:390px;
    overflow:auto;
    display: inline-block;
    position:fixed;
    top:205px;
    right:85px;
}

.videofeed{
    position: absolute;
    top:200px;
    right:390px;
    height:375px;
    width:500px;
    -webkit-transform: scaleY(-1);
    transform: scaleY(-1);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.8);
    background-color: rgba(0, 30, 34, 0.85);
}

</style>
    <body>
        <img class="videofeed" src=<%= @video_url %>>

        <button id="chatbutton" class="chatbutton">CHAT <strong>ON</strong></button>
        <div id="chatbox" class="col-sm-3 col-sm-offset-4 frame" style="display:none">
        <div class="comments_box" id="comments_box">
            <ul style="list-style-type:none;margin:5px;padding:0px" class="commentlist" id="ul1">
                    <li style="width:100%" class="pinned_comment">
                        <div class="msj macro">
                        <div class="avatar"><img class="img-circle" style="width:100%;" src="https://vignette.wikia.nocookie.net/naruto/images/b/bb/Itachi.png/revision/latest?cb=20160125182202" /></div>
                            <div class="text text-l">
                                <p class="comment_text">Welcome to the Akatsuki Chat!</p>
                                <p class="comment_time"><small></small></p>
                            </div>
                        </div>
                    </li>
                <% @comments.each do |comment| %>
                <li data-id=<%= comment.id %> style="width:100%;">
                        <div class="msj-rta macro">
                            <div class="text text-r">
                                <p class="comment_username"> <%= comment.username %> </p>
                                <p class="comment_text"><%= comment.content %></p>
                                <p class="comment_time"><small><%= comment.time %></small></p>
                            </div>
                        <div class="avatar" style="padding:0px 0px 0px 10px !important"><img class="img-circle" style="width:100%;" src="https://i.pinimg.com/736x/5d/a0/8d/5da08d24bc4c7d2847ee5dfa1604b114--naruto-shippudden-naruto-pics.jpg" /></div>
                    </div>
                  </li>

                <% end %>


            </ul>
        </div>
        <div style="height:50px;background:whitesmoke !important">
            <input type="text" class="mytext" placeholder="Type a message"/>
        </div>
        </div>
    </body>


<script>

var me = {};
me.avatar = "https://vignette.wikia.nocookie.net/naruto/images/b/bb/Itachi.png/revision/latest?cb=20160125182202";

var you = {};
you.avatar = "https://i.pinimg.com/736x/5d/a0/8d/5da08d24bc4c7d2847ee5dfa1604b114--naruto-shippudden-naruto-pics.jpg";

function formatAMPM(date) {
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0'+minutes : minutes;
    var strTime = hours + ':' + minutes + ' ' + ampm;
    return strTime;
}

//-- No use time. It is a javaScript effect.
function insertChat(who, text, time = 0){
    var control = "";
    var date = formatAMPM(new Date());
    var is_bottom = true;
    var element = document.getElementById("comments_box");
    if(element.scrollTop < element.scrollHeight - 500){
        is_bottom = false;
    }

    if (who == "me"){

        control = '<li style="width:100%">' +
                        '<div class="msj macro">' +
                        '<div class="avatar"><img class="img-circle" style="width:100%;" src="'+ me.avatar +'" /></div>' +
                            '<div class="text text-l">' +
                                '<p>'+ text +'</p>' +
                                '<p><small>'+date+'</small></p>' +
                            '</div>' +
                        '</div>' +
                    '</li>';
    }else{
        control = '<li style="width:100%;">' +
                        '<div class="msj-rta macro">' +
                            '<div class="text text-r">' +
                                '<p>'+text+'</p>' +
                                '<p><small>'+date+'</small></p>' +
                            '</div>' +
                        '<div class="avatar" style="padding:0px 0px 0px 10px !important"><img class="img-circle" style="width:100%;" src="'+you.avatar+'" /></div>' +
                  '</li>';
    }
    setTimeout(
        function(){
            $(".commentlist").append(control);

        }, time);
    setTimeout(
        function(){
            if(is_bottom){
                var elm = document.getElementById("comments_box");
                elm.scrollTop = elm.scrollHeight;
            }
        }, time);

}

function resetChat(){
    $(".commentlist").empty();
}

$("#chatbutton").click(function toggleChat() {
    $("#chatbox").toggle("fast", function(){
        var chat_text = document.getElementById("chatbutton");
        if(chat_text.innerHTML == "CHAT <strong>ON</strong>"){
            var elm = document.getElementById("comments_box");
            elm.scrollTop = elm.scrollHeight;
            chat_text.innerHTML = "CHAT <strong>OFF</strong>";
        }else{
            chat_text.innerHTML = "CHAT <strong>ON</strong>";

        }
    });
});

$(".mytext").on("keyup", function(e){
    if (e.which == 13){
        var text = $(this).val();
        if (text !== ""){
            // insertChat("you", text);
            submit_text = {"text":text};
            submit_message(submit_text);
            $(this).val('');
        }
    }
});

function submit_message(text){
    return $.ajax({
        url:'/comment',
        data:text,
        dataType:'json',
        type:'POST'
    });
}

//-- resetChat();

setTimeout(
    function(){
            var elm = document.getElementById("comments_box");
            elm.scrollTop = elm.scrollHeight;
    }, 2000);



//-- NOTE: No use time on insertChat.



</script>

</html>
